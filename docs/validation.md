# Order Validation Rules

## ðŸ“‹ Overview
Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð·Ð°ÐºÐ°Ð·Ð¾Ð² Ð´Ð»Ñ Ð¼Ð¸ÐºÑ€Ð¾ÑÐµÑ€Ð²Ð¸ÑÐ° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð·Ð°ÐºÐ°Ð·Ð¾Ð². Ð’ÑÐµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑŽÑ‚ÑÑ ÑÑ‚Ñ€Ð¾Ð³Ð¾ ÑÐ¾Ð³Ð»Ð°ÑÐ½Ð¾ Ð±Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐµ.

## ðŸŽ¯ Main Order Validation

### ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ:
- `order_uid` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `track_number` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹ (Ð¿Ð¾ÑÐ»Ðµ trim)
- `entry` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹ (Ð¿Ð¾ÑÐ»Ðµ trim)
- `locale` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹ (Ð¿Ð¾ÑÐ»Ðµ trim)
- `customer_id` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹ (Ð¿Ð¾ÑÐ»Ðµ trim)
- `delivery_service` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹ (Ð¿Ð¾ÑÐ»Ðµ trim)
- `shardkey` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹ (Ð¿Ð¾ÑÐ»Ðµ trim)
- `oof_shard` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹ (Ð¿Ð¾ÑÐ»Ðµ trim)

### Ð§Ð¸ÑÐ»Ð¾Ð²Ñ‹Ðµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ:
- `sm_id` â‰¥ 0 (Ð½Ðµ Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹)

### Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ:
- `date_created` - Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
- `date_created` â‰¤ Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ (Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ¼)

## ðŸšš Delivery Validation

### ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ:
- `name` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `phone` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `zip` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `city` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `address` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `region` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `email` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹

### Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸:
- `email` - Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð²Ð°Ð»Ð¸Ð´Ð½Ñ‹Ð¼ email Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¾Ð¼

## ðŸ’³ Payment Validation

### ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ:
- `transaction` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `currency` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `provider` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `bank` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹

### Ð§Ð¸ÑÐ»Ð¾Ð²Ñ‹Ðµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ:
- `amount` â‰¥ 0
- `payment_dt` > 0 (Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ timestamp)
- `delivery_cost` â‰¥ 0
- `goods_total` â‰¥ 0
- `custom_fee` â‰¥ 0

## ðŸ›ï¸ Items Validation

### ÐžÐ±Ñ‰Ð¸Ðµ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ:
- ÐœÐ¸Ð½Ð¸Ð¼ÑƒÐ¼ 1 Ñ‚Ð¾Ð²Ð°Ñ€ Ð² Ð·Ð°ÐºÐ°Ð·Ðµ
- Ð’ÑÐµ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒ Ð¸Ð½Ð´Ð¸Ð²Ð¸Ð´ÑƒÐ°Ð»ÑŒÐ½ÑƒÑŽ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ

### Per Item Validation:

#### ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ:
- `track_number` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `rid` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `name` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `size` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
- `brand` - Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹

#### Ð§Ð¸ÑÐ»Ð¾Ð²Ñ‹Ðµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ:
- `chrt_id` > 0 (Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹)
- `price` â‰¥ 0
- `sale` âˆˆ [0, 100] (Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾)
- `total_price` â‰¥ 0
- `nm_id` > 0 (Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹)
- `status` â‰¥ 0

## ðŸš¨ Error Handling

### Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾ÑˆÐ¸Ð±Ð¾Ðº:
- ÐšÐ°Ð¶Ð´Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»Ñ Ð¸ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñƒ
- Ð’Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ð¸Ð¼ÐµÑŽÑ‚ Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÑ‹ (`delivery validation failed: `, `item %d: `)
- Ð’ÑÐµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð½Ð° Ð°Ð½Ð³Ð»Ð¸Ð¹ÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐµ

### ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº:
```
"order_uid is required"
"delivery validation failed: email has invalid format"
"item 2: sale must be between 0 and 100"
"payment validation failed: amount must be non-negative"
```

## âœ… Validation Flow

1. **Main Order** â†’ Ð±Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð¿Ð¾Ð»Ñ Ð·Ð°ÐºÐ°Ð·Ð°
2. **Delivery** â†’ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐµ
3. **Payment** â†’ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ
4. **Items** â†’ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ñ‚Ð¾Ð²Ð°Ñ€Ð°

Ð•ÑÐ»Ð¸ Ð»ÑŽÐ±Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° fails - Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð½ÐµÐ¼ÐµÐ´Ð»ÐµÐ½Ð½Ð¾ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ Ð¾ÑˆÐ¸Ð±ÐºÐ°.

## ðŸ›¡ï¸ Security Notes

- Ð’ÑÐµ ÑÑ‚Ñ€Ð¾ÐºÐ¾Ð²Ñ‹Ðµ Ð¿Ð¾Ð»Ñ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´ÑÑ‚ `strings.TrimSpace()` Ð¿ÐµÑ€ÐµÐ´ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¾Ð¹
- Email Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹ `net/mail.ParseAddress`
- ÐÐµÑ‚ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¾Ðº Ð½Ð° Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð´Ð»Ð¸Ð½Ñ‹ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð½Ð° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ)
- Ð’ÑÐµ Ñ‡Ð¸ÑÐ»Ð¾Ð²Ñ‹Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð²ÐºÐ»ÑŽÑ‡Ð°ÑŽÑ‚ Ð³Ñ€Ð°Ð½Ð¸Ñ‡Ð½Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ (â‰¥ 0, > 0)